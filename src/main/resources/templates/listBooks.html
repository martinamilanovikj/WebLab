<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Books List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">

    <h1>Books List</h1>
    <form th:action="@{/books}" method="get" class="row g-3 mb-3">
        <div class="col-auto">
            <input type="text" name="title" class="form-control" placeholder="Filter by title"
                   th:value="${title}">
        </div>

        <div class="col-auto">
            <select name="genre" class="form-select">
                <option value="" th:text="'All Genres'" th:selected="${genre == null or genre.isEmpty()}"></option>
                <option th:each="g : ${genres}"
                        th:value="${g}"
                        th:text="${g}"
                        th:selected="${genre != null and genre == g}">
                </option>
            </select>


        </div>

        <div class="col-auto">
            <input type="number" step="0.01" min="0" name="averageRating" class="form-control"
                   placeholder="Filter by rating" th:value="${averageRating}">
        </div>

        <div class="col-auto">
            <button type="submit" class="btn btn-primary">Filter</button>
        </div>
    </form>


    <a th:href="@{/books/book-form}" class="btn btn-success mb-3"
       sec:authorize="hasRole('ADMIN')">Add New Book</a>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th>Title</th>
            <th>Genre</th>
            <th>Rating</th>
            <th>Author</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="book : ${books}">
            <td th:text="${book.title}">Title</td>
            <td th:text="${book.genre}">Genre</td>
            <td th:text="${book.averageRating}">Rating</td>
            <td th:text="${book.author != null} ? ${book.author.name} + ' ' + ${book.author.surname} : 'Unknown'">Author</td>
            <td>
                <a th:href="@{'/books/book-form/' + ${book.id}}" class="btn btn-info btn-sm"
                   sec:authorize="hasRole('ADMIN')">Edit</a>

                <form th:action="@{'/books/delete/' + ${book.id}}" method="post" style="display:inline">
                    <button type="submit" class="btn btn-danger btn-sm"
                            sec:authorize="hasRole('ADMIN')">Delete</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

    <h2>Reserve a Book</h2>
    <form th:action="@{/bookReservation}" method="post">
        <div class="mb-3">
            <label for="bookTitle" class="form-label">Choose a Book:</label>
            <select id="book" name="book" class="form-select" required>
                <option th:each="book : ${books}" th:value="${book.id}"
                        th:text="${book.title} + ' (' + ${book.genre} + ')'">
                </option>
            </select>
        </div>

        <div class="mb-3">
            <label for="numCopies" class="form-label">Number of Copies:</label>
            <input type="number" id="numCopies" name="numCopies" class="form-control" min="1" max="10" required>
        </div>

        <div class="mb-3">
            <label for="readerName" class="form-label">Your Name:</label>
            <input type="text" id="readerName" name="readerName" class="form-control" required>
        </div>

        <div class="mb-3">
            <label for="readerAddress" class="form-label">Your Address:</label>
            <input type="text" id="readerAddress" name="readerAddress" class="form-control" required>
        </div>

        <button type="submit" class="btn btn-primary">Reserve Book</button>
    </form>

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
